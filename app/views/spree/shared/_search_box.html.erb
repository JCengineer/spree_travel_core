<%
  active_product = ''
  active = true
%>


<ul id="search_box_tabs" class="nav nav-tabs">
  <% Spree::ProductType.enabled.each do |p| %>
    <%
      prefix = "#{p.name.downcase}_"
      if active
        active_product = p.name.downcase
        active_class = 'active'
        active = false
      else
        active_class = ''
      end
    %>
    <%= content_tag :li, class: active_class, role: 'presentation'  do %>
      <a data-toggle="tab" role="tab" href='#<%="#{prefix}"%>fields' name=<%="#{p.name}"%> ><%= Spree.t(p.name) %></a>
    <% end %>
  <% end %>
</ul>

<input type="hidden" id="the_product_type" name="product_type" value="<%= active_product %>">

    <div id="tabcontent" class="tab-content">
      <% Spree::ProductType.enabled.each do |p| %>
        <% prefix = "#{p.name.downcase}_" %>
        <!-- TODO esto es para poner valores por defecto, pero no creo que est'e bien
        porque no se adapta a todos los escenarios adem'as de ejecutarce X cada ProductType  -->
        <%
          hash = { "#{prefix}start_date" => Time.now.to_date,
                     "#{prefix}end_date" => Time.now.to_date + 3,
                     "#{prefix}adult" => 2,
                     "#{prefix}child" => 0 }

          if p.name.downcase == active_product
            active_tab = 'active'
          else
            active_tab = ''
          end
          unless @product.nil?
            function_name = "fill_cart_hiddens(#{@product.id})"
          end
        %>
        <div id='<%="#{prefix}fields"%>' class="tab-pane <%= active_tab %>" role="tabpanel">
          <ul class="alpha twelve columns omega" >
    	    <% p.search_box_option_types.each do |ot| %>
            <% tag_name = prefix + ot.name %>
    	      <li class="eleven columns search_box_row">
              <div class="two columns search_box_left">
    	          <%= label_tag tag_name, Spree.t(ot.presentation) %>
              </div>
              <div class="eight columns search_box_right">
      	        <% current_value = hash[tag_name] %>
      	        <% if ot.attr_type == 'selection' %>
      	          <%= select_tag tag_name, options_for_select(ot.option_values.map { |ov| [ov.presentation, ov.id] }, current_value), :class => "select2 #{prefix}selects", 'onchange' => function_name %>
      	        <% elsif ot.attr_type == 'integer' %>
      	          <%= number_field_tag tag_name, current_value, :class => "#{prefix}inputs", 'onchange' => function_name %>
      	        <% elsif ot.attr_type == 'float' %>
      	          <%= number_field_tag tag_name, current_value , :class => "#{prefix}inputs", 'onchange' => function_name %>
      	        <% elsif ot.attr_type == 'boolean' %>
      	          <%= check_box_tag tag_name, 1, :class => "#{prefix}inputs", 'onchange' => function_name %>
      	        <% elsif ot.attr_type == 'date' %>
      	          <%= text_field_tag tag_name, current_value, :class => "datepicker #{prefix}inputs", 'onchange' => function_name %>
      	        <% else %>
      	          <%= text_field_tag tag_name, current_value, :class => "#{prefix}inputs", 'onchange' => function_name %>
      	        <% end %>
              </div>
    	      </li>
    	    <% end %>
          </ul>
          <%= check_box_tag prefix + 'change_visibility', 'yes', false, class: 'visibility_check_box' %>
          <%= label_tag prefix + 'change_visibility', Spree.t(:show_only_available_products) %>
        </div>

      <% end %>
    </div>
